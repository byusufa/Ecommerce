<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Homepage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <!-- Categories Sidebar -->
        <div class="col-md-2 border-end pt-4">
            <h5 class="mb-4">Categories</h5>
            <div id="category-list"></div>
        </div>

        <!-- Product Section -->
        <div class="col-md-10 pt-4 px-4">
            <!-- Top Bar -->
            <div class="d-flex justify-content-end mb-4 gap-2">
                <button class="btn btn-outline-secondary">Avatar</button>

                <a href="basket.html" class="btn btn-primary">Basket</a>
            </div>

            <!-- Product List -->
            <div class="row" id="product-list">
                <!-- Product cards appear here -->
            </div>
        </div>
    </div>
</div>

<!-- Axios -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
    function getCategories() {
        axios({
            url: "http://localhost:8080/api/category",
            method: "GET",
            headers: {
                "Authorization": localStorage.getItem("token")
            }
        }).then(res => {
            let s = `
                <button class="btn btn-outline-primary w-100 mb-2" onclick="getProducts(null)">
                    All
                </button>
            `;
            for (let item of res.data) {
                s += `
                    <button class="btn btn-outline-primary w-100 mb-2" onclick="getProducts(${item.id})">
                        ${item.name}
                    </button>
                `;
            }
            document.getElementById("category-list").innerHTML = s;
        }).catch(err => {
            console.error("Error loading categories:", err);
        });
    }

    function getProducts(categoryId = null) {
        const url = categoryId === null
            ? "http://localhost:8080/api/product"
            : "http://localhost:8080/api/product/category/" + categoryId;

        axios({
            url: url,
            method: "GET",
            headers: {
                "Authorization": localStorage.getItem("token")
            }
        }).then(res => {
            let s = "";
            for (let item of res.data) {
                s += `
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                        <div class="card h-100">
                            <img src="http://localhost:8080/api/file/${item.attachment.id}"
                                 alt="Image Not Found" class="card-img-top">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-text">${"name: " + item.name}</h5>
                                <h5 class="card-text">${"price: " + item.price + " so'm"}</h5>
                                <button class="btn btn-primary mt-auto" onclick="addToBasket(${item.id}, event)">
                                    Basket
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            document.getElementById("product-list").innerHTML = s;
        }).catch(err => {
            console.error("Error loading products:", err);
        });
    }

    function addToBasket(productId, event) {
        let basket = JSON.parse(localStorage.getItem("array")) || [];
        let button = event.target;
        if (basket.includes(productId)) {
            basket = basket.filter(id => id !== productId);
            button.innerText = "Add Basket";
            button.style.background = "green"
        } else {
            basket.push(productId);
            button.innerText = "Remove";
            button.style.background = "red"
        }

        localStorage.setItem("array",JSON.stringify(basket));
    }


    getCategories();
    getProducts();
</script>

</body>
</html>
